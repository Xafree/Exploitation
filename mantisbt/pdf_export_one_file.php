<?php

namespace sandboxBundle\Controller;
require __DIR__ . '/vendor/autoload.php';
use Knp\Snappy\Pdf;
use Sensio\Bundle\FrameworkExtraBundle\configuration\Route;
use Symfony\Component\HttpFoundation\Session\SessionInterface;
use Symfony\Bundle\FrameworkBundle\Controller\Controller;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;

require_once( 'core.php' );
/*
class DefaultController extends Controller{
    public function indexAction(Request $request){
        $snappy = new Pdf('/usr/bin/wkhtmltopdf');
        $filename = 'SnappyPDF';
        $url = 'http://www.google.fr';
        
        return new Response(
            $snappy->getOutput($url),
            200,
            array(
                'Content-Type'          => 'application/pdf',
                'Content-Disposition'   => 'attachment; filename = "file.pdf"'
            )
        );
    }

}

*/
// Program to display complete URL 
$link ='http://sisyphe.extranet.f-g.fr/~eeberst/integration/Exploitation/mantisbt/view.php?id=3'; 
$PHPSESSID = $_COOKIE['PHPSESSID'];
$MANTIS_STRING_COOKIE = $_COOKIE['MANTIS_STRING_COOKIE'];
$option = array('cookie', array('PHPSESSID' => $PHPSESSID,"MANTIS_STRING_COOKIE" => $MANTIS_STRING_COOKIE));
// Display the complete URL 
//$request = new Controller;
//$save_session = $request->getRequest()->getSession();
//$save_session->save();
$snappy = new Pdf('/usr/bin/wkhtmltopdf');
//exec("/usr/bin/wkhtmltopdf --lowquality --cookie 'PHPSESSID' 'i88h836b2liebqeo0cjrs9jlt0' --cookie 'MANTIS_STRING_COOKIE' '42HHVHHmV7a41oihmgM_ierarmqMaCtYZ4cLL3L48Cz6iVn27O7_dqEoCb1bifFw' 'http://sisyphe.extranet.f-g.fr/~eeberst/integration/Exploitation/mantisbt/view.php?id=3' '/tmp/knp_snappy5f1adbb0894591.20744363.pdf '");
///set_time_limit (0);
$snappy->setTimeout(300); // 600 seconds 
header('Content-Type: application/pdf');
//header('Content-Disposition: attachment; filename="file.pdf"'); // permet de dl le pdf
//sleep(60);
$snappy->setOption('cookie', array('PHPSESSID' => $PHPSESSID,"MANTIS_STRING_COOKIE" => $MANTIS_STRING_COOKIE));
//$snappy->setOption('cookie',$MANTIS_STRING_COOKIE);
echo $snappy->getOutput($link);
